<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agendamento - GHG Barbearia</title>
  <link rel="stylesheet" href="agenda.css" />
</head>

<body>
  <header>
    <nav class="navbar">
      <div class="navbar-container">
        <a class="navbar-brand" href="./index.html">
          <img src="../img/logo.png" alt="logo" />
        </a>
        <ul class="navbar-nav" id="navbarNav">
          <li><a class="nav-link" href="./index.html">Home</a></li>
          <li><a class="nav-link" href="./sobreNos.html">História</a></li>
          <li><a class="nav-link" href="./agenda.html">Agenda</a></li>
        </ul>
      </div>
    </nav>
  </header>
  <main class="container" role="main">
    <h1 class="main-title">Agendamento rápido</h1>

    <!-- Barbeiros -->
    <section class="section barbeiros" aria-label="Escolha do barbeiro">
      <h2>Quem vai te atender?</h2>
      <div class="grid" role="list">
        <button class="barbeiro-btn" aria-label="Selecionar barbeiro Gabriel" role="listitem" type="button">
          <img src="img/gabriel.jpg" alt="Barbeiro Gabriel" />
          <span>Gabriel</span>
        </button>
        <button class="barbeiro-btn" aria-label="Selecionar barbeiro Gustavo" role="listitem" type="button">
          <img src="img/gustavo.jpg" alt="Barbeiro Gustavo" />
          <span>Gustavo</span>
        </button>
        <button class="barbeiro-btn" aria-label="Selecionar barbeiro Henry" role="listitem" type="button">
          <img src="img/henry.jpg" alt="Barbeiro Henry" />
          <span>Henry</span>
        </button>
      </div>
    </section>

    <!-- Data -->
    <section class="section" aria-label="Escolha da data">
      <h2>Escolha uma data disponível</h2>
      <input type="date" id="dataSelecionada" aria-label="Campo para escolher a data do agendamento" />
    </section>

    <!-- Horários -->
    <section class="section" aria-label="Escolha do horário">
      <h2>Qual horário você prefere?</h2>
      <div class="grid horarios" role="list">
        <button class="btn-horario" type="button" role="listitem">
          08:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          09:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          09:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          10:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          10:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          11:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          11:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          12:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          12:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          13:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          13:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          14:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          14:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          15:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          15:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          16:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          16:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          17:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          17:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          18:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          18:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          19:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          19:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          20:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          20:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          21:00
        </button>
        <button class="btn-horario" type="button" role="listitem">
          21:30
        </button>
        <button class="btn-horario" type="button" role="listitem">
          22:00
        </button>
      </div>
    </section>

    <!-- Serviços -->
    <section class="section" aria-label="Escolha do serviço">
      <h2>Qual serviço deseja?</h2>
      <div class="grid servicos" role="list">
        <button class="servico-btn" type="button" role="listitem">
          Corte - R$30
        </button>
        <button class="servico-btn" type="button" role="listitem">
          Blindadao - R$50
        </button>
        <button class="servico-btn" type="button" role="listitem">
          Barba - R$20
        </button>
        <button class="servico-btn" type="button" role="listitem">
          Corte + Barba - R$45
        </button>
      </div>
    </section>

    <!-- Resumo -->
    <section class="section resumo" aria-live="polite" aria-label="Resumo do agendamento">
      <h2>Resumo do seu agendamento</h2>
      <ul class="resumo-list">
        <li><strong>Barbeiro:</strong> <span id="resumoBarbeiro">-</span></li>
        <li><strong>Data:</strong> <span id="resumoData">-</span></li>
        <li><strong>Horário:</strong> <span id="resumoHorario">-</span></li>
        <li><strong>Serviço:</strong> <span id="resumoServico">-</span></li>
        <li><strong>Total:</strong> R$<span id="resumoPreco">0</span></li>
      </ul>
      <button class="confirmar-btn" type="button" aria-label="Confirmar agendamento">
        Confirmar Agendamento
      </button>
    </section>
  </main>

  <script>
    // Definição de variáveis
    let barbeiroSelecionado = null;
    let horarioSelecionado = null;
    let servicoSelecionado = null;
    let precoSelecionado = 0;

    // Elementos DOM
    const resumoBarbeiro = document.getElementById("resumoBarbeiro");
    const resumoData = document.getElementById("resumoData");
    const resumoHorario = document.getElementById("resumoHorario");
    const resumoServico = document.getElementById("resumoServico");
    const resumoPreco = document.getElementById("resumoPreco");
    const dataInput = document.getElementById("dataSelecionada");
    const confirmarBtn = document.querySelector(".confirmar-btn");
    const botoesHorario = document.querySelectorAll(".btn-horario");

    // Define data mínima (hoje) para o input date
    const hoje = new Date().toISOString().split("T")[0];
    dataInput.setAttribute("min", hoje);

    // Atualiza resumo no DOM
    function atualizarResumo() {
      resumoBarbeiro.textContent = barbeiroSelecionado || "-";
      resumoData.textContent = dataInput.value || "-";
      resumoHorario.textContent = horarioSelecionado || "-";
      resumoServico.textContent = servicoSelecionado || "-";
      resumoPreco.textContent = precoSelecionado || "0";
    }

    // Função para limpar seleção (retira classe ativo)
    function limparSelecao(seletor) {
      document.querySelectorAll(seletor).forEach((el) => {
        el.classList.remove("ativo");
      });
    }

    // Bloqueia horários inválidos se a data for hoje
    function bloquearHorarios() {
      const dataEscolhida = dataInput.value;
      const agora = new Date();

      if (dataEscolhida === hoje) {
        const horaAtual = agora.getHours();
        const minutoAtual = agora.getMinutes();

        botoesHorario.forEach((botao) => {
          const [hora, minuto] = botao.textContent.trim().split(":").map(Number);

          if (hora < horaAtual || (hora === horaAtual && minuto < minutoAtual)) {
            botao.disabled = true;
            botao.classList.remove("ativo");
            botao.classList.add("desabilitado");
            if (horarioSelecionado === botao.textContent.trim()) {
              horarioSelecionado = null;
              atualizarResumo();
            }
          } else {
            botao.disabled = false;
            botao.classList.remove("desabilitado");
          }
        });
      }
      // Garantir que nao funcione mesmo se o usuario forcar a data anterior a de hoje
      else if (dataEscolhida < hoje) {
        botoesHorario.forEach((botao) => {
          botao.disabled = true;
          botao.classList.remove("ativo");
          botao.classList.add("desabilitado");
          if (horarioSelecionado === botao.textContent.trim()) {
            horarioSelecionado = null;
            atualizarResumo();
          }
        });
      }
      else {
        botoesHorario.forEach((botao) => {
          botao.disabled = false;
          botao.classList.remove("desabilitado");
        });
      }
    }

    // Eventos para selecionar barbeiro
    document.querySelectorAll(".barbeiro-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        limparSelecao(".barbeiro-btn");
        btn.classList.add("ativo");
        barbeiroSelecionado = btn.querySelector("span").textContent.trim();
        atualizarResumo();
      });
    });

    // Eventos para selecionar horário
    document.querySelectorAll(".btn-horario").forEach((btn) => {
      btn.addEventListener("click", () => {
        if (btn.disabled) return; // Ignora clique se estiver desabilitado
        limparSelecao(".btn-horario");
        btn.classList.add("ativo");
        horarioSelecionado = btn.textContent.trim();
        atualizarResumo();
      });
    });

    // Eventos para selecionar serviço e preço
    const precosServicos = {
      Corte: 30,
      Barba: 20,
      "Corte + Barba": 45,
      Blindadao: 50
    };

    document.querySelectorAll(".servico-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        limparSelecao(".servico-btn");
        btn.classList.add("ativo");
        servicoSelecionado = btn.textContent.split(" - ")[0].trim();
        precoSelecionado = precosServicos[servicoSelecionado] || 0;
        atualizarResumo();
      });
    });

    // Evento para atualizar data no resumo e bloquear horários inválidos
    dataInput.addEventListener("change", () => {
      bloquearHorarios();
      atualizarResumo();
    });

    // Evento para confirmar agendamento
    confirmarBtn.addEventListener("click", () => {
      if (
        barbeiroSelecionado &&
        dataInput.value &&
        horarioSelecionado &&
        servicoSelecionado
      ) {
        alert(
          `Agendamento confirmado!\n\nBarbeiro: ${barbeiroSelecionado}\nData: ${dataInput.value}\nHorário: ${horarioSelecionado}\nServiço: ${servicoSelecionado} - R$${precoSelecionado}\n\nNos vemos em breve 😎`
        );
      } else {
        alert(
          "Por favor, selecione barbeiro, data, horário e serviço antes de confirmar."
        );
      }
    });

    // bloqueiar horários ao carregar a página
    window.addEventListener("load", () => {
      bloquearHorarios();
      atualizarResumo();
    });

  </script>
</body>

</html>
